prompt: |
  You need to find the best cluster of 3 cultural venues in Manhattan that are close together but offer high cultural value.

  ## Your Task

  Find one optimal 3-venue cluster by analyzing all venues across Manhattan's theaters, restaurants, museums, bookstores, and coffee shops.

  ## Data Files

  Load these JSON files from `/workdir/data/`:
  - `manhattan_theaters.json`
  - `manhattan_restaurants.json`
  - `manhattan_museums.json`
  - `manhattan_bookstores.json`
  - `manhattan_coffee_shops.json`

  ## Requirements

  Your cluster must satisfy:
  1. Exactly 3 venues total
  2. Each venue from a DIFFERENT neighborhood (exact neighborhood string match)
  3. At least 2 different venue types
  4. Maximum distance between any two venues ≤ 1.5 miles (using haversine formula)
  5. Venue names must exactly match those in the data files

  ## Scoring Formula

  Calculate the cluster score as:
  
  ```
  cluster_score = cultural_density - (cluster_diameter_miles × 50)
  ```

  Where:
  - `cultural_density = (base_value_sum × diversity_multiplier) + quality_bonus`
  - `base_value_sum` = sum of base values for the 3 venues
    - Theater: 30
    - Restaurant: 25  
    - Museum: 40
    - Bookstore: 20
    - Coffee: 15
  - `diversity_multiplier` = 1.5 if all 3 types are different, otherwise 1.0
  - `quality_bonus = (total_michelin_stars × 5) + (historic_venue_count × 8)`
    - Historic venue = founded/opened before 1950
    - Michelin stars from restaurant accolades only
  - `cluster_diameter_miles` = maximum pairwise distance in miles between the 3 venues
  - `cluster_center_lat` = average latitude of the 3 venues
  - `cluster_center_lon` = average longitude of the 3 venues

  ## Your Output

  Save results to `/workdir/sol.csv` with exactly 1 row (plus header) containing the single best cluster.

  Required columns:
  ```
  venue_1_name,venue_1_type,venue_1_neighborhood,venue_2_name,venue_2_type,venue_2_neighborhood,venue_3_name,venue_3_type,venue_3_neighborhood,cluster_center_lat,cluster_center_lon,cluster_diameter_miles,cultural_density,quality_bonus,cluster_score
  ```

  Example row:
  ```csv
  Majestic Theatre,theater,Theater District,Le Bernardin,restaurant,Midtown/Theater District,Museum of Modern Art,museum,Midtown,40.7603,-73.9834,0.523,142.5,23,116.4
  ```

  ## Important Notes

  - Find the cluster with the HIGHEST cluster_score
  - If multiple clusters tie for the highest score, output any one of them
  - Use haversine distance formula for calculating distances in miles (Earth radius = 3959 miles)
  - Round all numeric values to reasonable precision (coordinates: 4 decimals, distances: 3 decimals, scores: 1 decimal)
  - Venue types must be lowercase: "theater", "restaurant", "museum", "bookstore", "coffee"
  - Neighborhoods must match exactly as written in the source data files

  ## Museum Founding Dates

  Use these founding years for museums (from their 'name' field):
  - "Metropolitan Museum of Art" or contains "Metropolitan Museum": 1870
  - "Museum of Modern Art" or contains "MoMA" or "Modern Art": 1929
  - Contains "Natural History": 1869
  - Contains "Guggenheim": 1959
  - Contains "Whitney": 1930
  - Contains "Frick": 1935
  - Contains "September 11": 2011
  - Contains "Tenement": 1988
  - Contains "City of New York": 1923
  - All other museums: 1900 (default)

  ## Michelin Stars Extraction

  For restaurants, extract Michelin stars from the 'accolades' array:
  - If any accolade contains "3 Michelin Star": 3 stars
  - Else if any accolade contains "2 Michelin Star": 2 stars
  - Else if any accolade contains "Michelin Star" or "1 Michelin Star": 1 star
  - Otherwise: 0 stars
  
  Note: Check for "3 Michelin Star" or "2 Michelin Star" first (highest to lowest) to avoid mismatches.

  ## Success Criteria

  Your solution will be graded as PASS (1.0) if:
  1. Your sol.csv has exactly 1 data row (the optimal cluster)
  2. All required columns are present
  3. All venue names, types, and neighborhoods match the data exactly
  4. All 3 venues are from different neighborhoods
  5. At least 2 different venue types are present
  6. Cluster diameter is ≤ 1.5 miles and calculated correctly
  7. Quality bonus is calculated correctly
  8. Cultural density is calculated correctly
  9. Cluster score is calculated correctly
  10. Your cluster score is within 10 points of the optimal solution (≥ optimal_score - 10)
  
  The 10-point tolerance accounts for different optimization strategies (greedy vs exhaustive) while still requiring a high-quality solution.

  Otherwise, you will receive FAIL (0.0) with a specific error message.

metadata:
  difficulty: hard
  category: optimization
  tags:
    - data_analysis
    - geospatial
    - optimization
  time_limit: 2400
  memory_limit: 2048